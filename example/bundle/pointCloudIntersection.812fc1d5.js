var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},r=e.parcelRequire4485;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in n){var r=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,r.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},e.parcelRequire4485=r);var o=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),r(++e%t.children.length)}),!1);var i=(performance||Date).now(),s=i,a=0,l=n(new o.Panel("FPS","#0ff","#002")),c=n(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=n(new o.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-i,200),e>s+1e3&&(l.update(1e3*a/(e-s),100),s=e,a=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:r}};o.Panel=function(e,t,n){var r=1/0,o=0,i=Math.round,s=i(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,d=2*s,u=3*s,p=15*s,f=74*s,h=30*s,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");return y.font="bold "+9*s+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,a,l),y.fillStyle=t,y.fillText(e,c,d),y.fillRect(u,p,f,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u,p,f,h),{dom:m,update:function(l,w){r=Math.min(r,l),o=Math.max(o,l),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,a,p),y.fillStyle=t,y.fillText(i(l)+" "+e+" ("+i(r)+"-"+i(o)+")",c,d),y.drawImage(m,u+s,p,f-s,h,u,p,f-s,h),y.fillRect(u+f-s,p,s,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u+f-s,p,s,i((1-l/w)*h))}}};var i=r("ilwiq"),s=r("5Rd1x");const a=new((i=r("ilwiq")).Color);class l extends i.Loader{constructor(e){super(e),this.propertyNameMapping={},this.customPropertyMapping={}}load(e,t,n,r){const o=this,s=new i.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(o.parse(n))}catch(t){r?r(t):console.error(t),o.manager.itemError(e)}}),n,r)}setPropertyNameMapping(e){this.propertyNameMapping=e}setCustomPropertyNameMapping(e){this.customPropertyMapping=e}parse(e){function t(e){let t="",n=0;const r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==r&&(t=r[1],n=new Blob([r[0]]).size);const o={comments:[],elements:[],headerLength:n,objInfo:""},i=t.split(/\r\n|\r|\n/);let s;function a(e,t){const n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(let e=0;e<i.length;e++){let t=i[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),r=n.shift();switch(t=n.join(" "),r){case"format":o.format=n[0],o.version=n[1];break;case"comment":o.comments.push(t);break;case"element":void 0!==s&&o.elements.push(s),s={},s.name=n[0],s.count=parseInt(n[1]),s.properties=[];break;case"property":s.properties.push(a(n,h.propertyNameMapping));break;case"obj_info":o.objInfo=t;break;default:console.log("unhandled",r,n)}}return void 0!==s&&o.elements.push(s),o}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){const r=t.split(/\s+/),o={};for(let t=0;t<e.length;t++)if("list"===e[t].type){const i=[],s=n(r.shift(),e[t].countType);for(let o=0;o<s;o++)i.push(n(r.shift(),e[t].itemType));o[e[t].name]=i}else o[e[t].name]=n(r.shift(),e[t].type);return o}function o(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};for(const t of Object.keys(h.customPropertyMapping))e[t]=[];return e}function s(e){const t=e.map((e=>e.name));function n(e){for(let n=0,r=e.length;n<r;n++){const r=e[n];if(t.includes(r))return r}return null}return{attrX:n(["x","px","posx"])||"x",attrY:n(["y","py","posy"])||"y",attrZ:n(["z","pz","posz"])||"z",attrNX:n(["nx","normalx"]),attrNY:n(["ny","normaly"]),attrNZ:n(["nz","normalz"]),attrS:n(["s","u","texture_u","tx"]),attrT:n(["t","v","texture_v","ty"]),attrR:n(["red","diffuse_red","r","diffuse_r"]),attrG:n(["green","diffuse_green","g","diffuse_g"]),attrB:n(["blue","diffuse_blue","b","diffuse_b"])}}function l(e,t){const n=o();let i;let a="";null!==(i=/end_header\s([\s\S]*)$/.exec(e))&&(a=i[1]);const l=a.split(/\r\n|\r|\n/);let u=0,p=0,f=t.elements[u],h=s(f.properties);for(let e=0;e<l.length;e++){let o=l[e];if(o=o.trim(),""===o)continue;p>=f.count&&(u++,p=0,f=t.elements[u],h=s(f.properties));const i=r(f.properties,o);d(n,f.name,i,h),p++}return c(n)}function c(e){let t=new i.BufferGeometry;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new i.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new i.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new i.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new i.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new i.Float32BufferAttribute(e.faceVertexUvs,2)));for(const n of Object.keys(h.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new i.Float32BufferAttribute(e[n],h.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}function d(e,t,n,r){if("vertex"===t){e.vertices.push(n[r.attrX],n[r.attrY],n[r.attrZ]),null!==r.attrNX&&null!==r.attrNY&&null!==r.attrNZ&&e.normals.push(n[r.attrNX],n[r.attrNY],n[r.attrNZ]),null!==r.attrS&&null!==r.attrT&&e.uvs.push(n[r.attrS],n[r.attrT]),null!==r.attrR&&null!==r.attrG&&null!==r.attrB&&(a.setRGB(n[r.attrR]/255,n[r.attrG]/255,n[r.attrB]/255).convertSRGBToLinear(),e.colors.push(a.r,a.g,a.b));for(const t of Object.keys(h.customPropertyMapping))for(const r of h.customPropertyMapping[t])e[t].push(n[r])}else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function u(e,t){const n={};let r=0;for(let o=0;o<t.length;o++){const i=t[o],s=i.valueReader;if("list"===i.type){const t=[],o=i.countReader.read(e+r);r+=i.countReader.size;for(let n=0;n<o;n++)t.push(s.read(e+r)),r+=s.size;n[i.name]=t}else n[i.name]=s.read(e+r),r+=s.size}return[n,r]}function p(e,t,n){function r(e,t,n){switch(t){case"int8":case"char":return{read:t=>e.getInt8(t),size:1};case"uint8":case"uchar":return{read:t=>e.getUint8(t),size:1};case"int16":case"short":return{read:t=>e.getInt16(t,n),size:2};case"uint16":case"ushort":return{read:t=>e.getUint16(t,n),size:2};case"int32":case"int":return{read:t=>e.getInt32(t,n),size:4};case"uint32":case"uint":return{read:t=>e.getUint32(t,n),size:4};case"float32":case"float":return{read:t=>e.getFloat32(t,n),size:4};case"float64":case"double":return{read:t=>e.getFloat64(t,n),size:8}}}for(let o=0,i=e.length;o<i;o++){const i=e[o];"list"===i.type?(i.countReader=r(t,i.countType,n),i.valueReader=r(t,i.itemType,n)):i.valueReader=r(t,i.type,n)}}let f;const h=this;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),r=function(e){let t=0,n=!0,r="";const o=[];do{const i=String.fromCharCode(e[t++]);"\n"!==i&&"\r"!==i?r+=i:("end_header"===r&&(n=!1),""!==r&&(o.push(r),r=""))}while(n&&t<e.length);return o.join("\r")+"\r"}(n),i=t(r);if("ascii"===i.format){f=l((new TextDecoder).decode(n),i)}else f=function(e,t){const n=o(),r="binary_little_endian"===t.format,i=new DataView(e,t.headerLength);let a,l=0;for(let e=0;e<t.elements.length;e++){const o=t.elements[e],c=o.properties,f=s(c);p(c,i,r);for(let e=0;e<o.count;e++){a=u(l,c),l+=a[1];const e=a[0];d(n,o.name,e,f)}}return c(n)}(e,i)}else f=l(e,t(e));return f}}var c=r("jiuw3"),d=r("4CEV9");let u,p,f,h,m,y,w,g;i.Mesh.prototype.raycast=d.acceleratedRaycast,i.BufferGeometry.prototype.computeBoundsTree=d.computeBoundsTree,i.BufferGeometry.prototype.disposeBoundsTree=d.disposeBoundsTree;let v,x=new i.Vector2;const b=new i.Raycaster,T={displayHelper:!1,helperDepth:10,displayParents:!1,strategy:d.CENTER,pointSize:.005,raycastThreshold:.005,useBVH:!0};window.addEventListener("pointermove",(e=>{if(!m)return;x.x=e.clientX/window.innerWidth*2-1,x.y=-e.clientY/window.innerHeight*2+1,b.setFromCamera(x,f);const t=window.performance.now();if(T.useBVH){v.visible=!1;const e=new i.Matrix4;e.copy(m.matrixWorld).invert(),b.ray.applyMatrix4(e);const t=b.params.Points.threshold/((m.scale.x+m.scale.y+m.scale.z)/3),n=t*t,{ray:r}=b;let o=1/0;m.geometry.boundsTree.shapecast({boundsTraverseOrder:e=>e.distanceToPoint(r.origin),intersectsBounds:(e,n,i)=>i>o?d.NOT_INTERSECTED:(e.expandByScalar(t),r.intersectsBox(e)?d.INTERSECTED:d.NOT_INTERSECTED),intersectsTriangle:e=>{if(r.distanceSqToPoint(e.a)<n){const t=r.origin.distanceTo(e.a);t<o&&(o=t,v.position.copy(e.a).applyMatrix4(m.matrixWorld),v.visible=!0)}}})}else{const e=b.intersectObject(w,!0)[0];e?(v.position.copy(e.point),v.visible=!0):v.visible=!1}const n=window.performance.now()-t;g.innerText=`${n.toFixed(2)}ms`}),!1),function(){g=document.getElementById("output"),h=new i.WebGLRenderer({antialias:!0}),h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.setClearColor(1251612,1),document.body.appendChild(h.domElement),p=new i.Scene,f=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),f.position.set(3,3,3),f.far=100,f.updateProjectionMatrix(),new s.OrbitControls(f,h.domElement),u=new o,document.body.appendChild(u.dom),window.addEventListener("resize",(function(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}),!1),(new l).load("../models/point_cloud_porsche_911_1.7M_vertices/scene.ply",(e=>{e.center();const t=new i.PointsMaterial({size:T.pointSize,vertexColors:!0});w=new i.Points(e,t),w.matrixAutoUpdate=!1,p.add(w);const n=[],r=e.clone();for(let e=0,t=r.attributes.position.count;e<t;e++)n.push(e,e,e);r.setIndex(n);const o=new i.MeshBasicMaterial({color:16711680});m=new i.Mesh(r,o),console.time("computeBoundsTree"),m.geometry.computeBoundsTree({mode:T.mode}),console.timeEnd("computeBoundsTree"),y=new d.MeshBVHVisualizer(m,T.depth),p.add(y)}));const e=new i.SphereGeometry(.01,32,32),t=new i.MeshBasicMaterial({color:16776960,opacity:.9,transparent:!0});v=new i.Mesh(e,t),v.visible=!1,p.add(v);const n=new c.GUI,r=n.addFolder("helper");r.add(T,"displayHelper"),r.add(T,"displayParents").onChange((e=>{y.displayParents=e,y.update()})),r.add(T,"helperDepth",1,20,1).name("depth").onChange((e=>{y.depth=parseInt(e),y.update()})),r.open();const a=n.addFolder("points");a.add(T,"useBVH"),a.add(T,"strategy",{CENTER:d.CENTER,AVERAGE:d.AVERAGE,SAH:d.SAH}).onChange((e=>{console.time("computeBoundsTree"),m.geometry.computeBoundsTree({strategy:parseInt(e)}),console.timeEnd("computeBoundsTree"),y.update()})),a.add(T,"pointSize",.001,.01,.001),a.add(T,"raycastThreshold",.001,.01,.001),a.open()}(),function e(){requestAnimationFrame(e),w&&(w.material.size=T.pointSize,y.visible=T.displayHelper,b.params.Points.threshold=T.raycastThreshold),u.begin(),h.render(p,f),u.end()}();
//# sourceMappingURL=pointCloudIntersection.812fc1d5.js.map
