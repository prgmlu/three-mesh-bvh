var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},o=e.parcelRequire4485;null==o&&((o=function(e){if(e in t)return t[e].exports;if(e in n){var o=n[e];delete n[e];var r={id:e,exports:{}};return t[e]=r,o.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},e.parcelRequire4485=o);var r=o("ilwiq"),i=o("jiuw3"),a=o("5Rd1x"),s=o("7lx9d"),d=o("4CEV9");r=o("ilwiq"),d=o("4CEV9");const c=new r.Vector3(0,1,0),l=function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Vector3,o=new r.Triangle;return function(i,a,s=1){const d=[],c=Math.pow(10,4),l=Math.cos(r.MathUtils.DEG2RAD*s),u=i.getIndex(),w=i.getAttribute("position"),p=u?u.count:w.count,f=[0,0,0],y=["a","b","c"],m=new Array(3),g={};for(let e=0;e<p;e+=3){u?(f[0]=u.getX(e),f[1]=u.getX(e+1),f[2]=u.getX(e+2)):(f[0]=e,f[1]=e+1,f[2]=e+2);const{a:t,b:i,c:s}=o;if(t.fromBufferAttribute(w,f[0]),i.fromBufferAttribute(w,f[1]),s.fromBufferAttribute(w,f[2]),o.getNormal(n),m[0]=`${Math.round(t.x*c)},${Math.round(t.y*c)},${Math.round(t.z*c)}`,m[1]=`${Math.round(i.x*c)},${Math.round(i.y*c)},${Math.round(i.z*c)}`,m[2]=`${Math.round(s.x*c)},${Math.round(s.y*c)},${Math.round(s.z*c)}`,m[0]!==m[1]&&m[1]!==m[2]&&m[2]!==m[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=m[e],s=m[t],c=o[y[e]],u=o[y[t]],w=`${i}_${s}`,p=`${s}_${i}`;if(p in g&&g[p]){const e=g[p].normal,t=n.dot(e)<=l,o=Math.sign(a.dot(n))!==Math.sign(a.dot(e));if(t||o){const e=new r.Line3;e.start.copy(c),e.end.copy(u),d.push(e)}g[p]=null}else w in g||(g[w]={index0:f[e],index1:f[t],normal:n.clone()})}}for(const n in g)if(g[n]){const{index0:o,index1:i}=g[n];e.fromBufferAttribute(w,o),t.fromBufferAttribute(w,i);const a=new r.Line3;a.start.copy(e),a.end.copy(t),d.push(a)}return d}}(),u=function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Vector3,o=new r.Plane,i=new r.Line3,a=new r.Line3,s=new r.Line3;return function(d,c,l=new r.Line3){if(c.needsUpdate&&c.needsUpdate(),c.getArea()<=1e-16)return null;const{points:u,plane:w}=c;i.copy(d),i.delta(e);if(!(0===w.normal.dot(e)))return null;e.cross(w.normal).normalize(),o.setFromNormalAndCoplanarPoint(e,i.start);let p=0;for(let e=0;e<3;e++){const t=u[e],n=u[(e+1)%3];if(s.start.copy(t),s.end.copy(n),0===o.distanceToPoint(s.end)&&0===o.distanceToPoint(s.start)){a.copy(s),p=2;break}if(o.intersectLine(s,0===p?a.start:a.end)){let e;if(e=0===p?a.start:a.end,0===e.distanceTo(n))continue;if(p++,2===p)break}}if(2===p){if(i.delta(e).normalize(),a.delta(t).normalize(),e.dot(t)<0){let e=a.start;a.start=a.end,a.end=e}const o=i.start.dot(e),r=i.end.dot(e),s=a.start.dot(e),d=a.end.dot(e),c=r<s,u=o<d;return o!==d&&s!==r&&c===u?null:(n.subVectors(i.start,a.start),n.dot(e)>0?l.start.copy(i.start):l.start.copy(a.start),n.subVectors(i.end,a.end),n.dot(e)<0?l.end.copy(i.end):l.end.copy(a.end),l)}return null}}(),w=function(){const e=new r.Line3;return function(t,n,o=null){e.start.copy(n),e.end.copy(n),e.start.y+=1e5,e.end.y-=1e5,t.intersectLine(e,o)}}(),p=function(){const e=new r.Vector3,t=new r.Vector3;return function(n,o){return e.lerpVectors(o.start,o.end,.5),w(n,e,t),t.y<e.y}}(),f=function(){const e=new r.Vector3,t=new r.Vector3(0,1,0);return function(n){return n.delta(e).normalize(),Math.abs(e.dot(t))>=1-1e-16}}();function y(e){return e.needsUpdate&&e.update(),Math.abs(e.plane.normal.dot(c))<=1e-16}function m(e,t){const n=e.points;let o=0;for(let e=0;e<3;e++){const{start:r,end:i}=t,a=n[e];r.distanceToSquared(a)<=1e-16&&o++,i.distanceToSquared(a)<=1e-16&&o++}return o>=2}const g=function(){const e=new r.Line3,t=new r.Vector3,n=new r.Vector3,o=new r.Vector3,i=new r.Line3,a=new d.ExtendedTriangle;return function(r,s,d){if(i.copy(s),a.copy(r),i.start.y=0,i.end.y=0,a.a.y=0,a.b.y=0,a.c.y=0,a.needsUpdate=!0,a.update(),u(i,a,e)){i.delta(t),n.subVectors(e.start,i.start),o.subVectors(e.end,i.start);let r=n.length()/t.length(),a=o.length()/t.length();return r=Math.min(Math.max(r,0),1),a=Math.min(Math.max(a,0),1),Math.abs(r-a)<=1e-16||d.push(new Float32Array([r,a])),!0}return!1}}(),h=function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Vector3,o=new r.Vector3;return function(r,i,a){r.needsUpdate&&r.update(),a.copy(i);const{plane:s}=r;if(y(r))return!1;i.delta(e);if(0===s.normal.dot(e))return!1;if(s.intersectLine(i,t)){const{start:e,end:i}=a;let s,d=!1;return e.distanceTo(t)>i.distanceTo(t)?s=e:(s=i,d=!0),n.lerpVectors(s,t,.5),w(r.plane,n,o),o.y<n.y?d?i.copy(t):e.copy(t):d?e.copy(t):i.copy(t),!0}return!1}}(),M=function(){const e=new r.Line3;return function(t,n,o=[]){b(n);const r=[[0,1]];for(let e=0,t=n.length;e<t;e++){const t=r[e],o=n[e];t[1]=o[0],r.push(new Float32Array([o[1],1]))}for(let n=0,i=r.length;n<i;n++){const{start:i,end:a}=t;e.start.lerpVectors(i,a,r[n][0]),e.end.lerpVectors(i,a,r[n][1]),o.push(new Float32Array([e.start.x,e.start.y,e.start.z,e.end.x,e.end.y,e.end.z]))}return o}}();function x(e,t=null){const n=new Float32Array(6*e.length);let o=0;for(let r=0,i=e.length;r<i;r++){const i=e[r];n[o++]=i[0],n[o++]=null===t?i[1]:t,n[o++]=i[2],n[o++]=i[3],n[o++]=null===t?i[4]:t,n[o++]=i[5]}const i=new r.BufferGeometry,a=new r.BufferAttribute(n,3,!0);return i.setAttribute("position",a),i}function b(e){e.sort(((e,t)=>e[0]-t[0]));for(let t=1;t<e.length;t++){const n=e[t],o=e[t-1];n[0]<=o[1]&&(o[1]=Math.max(o[1],n[1]),e.splice(t,1),t--)}}var V=o("7ePFa"),L=o("kp7Te");const B={displayModel:"color",displayEdges:!1,displayProjection:!0,useBVH:!0,sortEdges:!0,rotate:()=>{S.quaternion.random(),S.position.set(0,0,0),S.updateMatrixWorld(!0);const e=new r.Box3;e.setFromObject(P,!0),e.getCenter(S.position).multiplyScalar(-1),S.position.y=Math.max(0,-e.min.y)+1},regenerate:()=>{G=j()}};let A,$,v,E,T,F,P,z,S,q,C,G=null;function*j(e=30){C.innerText="processing: --",v.remove(z);let t=window.performance.now();const n=[];P.updateWorldMatrix(!0,!0),P.traverse((e=>{if(e.geometry){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);for(const e in t.attributes)"position"!==e&&t.deleteAttribute(e);n.push(t)}}));const o=V.mergeBufferGeometries(n,!1),i=window.performance.now()-t;yield,t=window.performance.now();const a=new d.MeshBVH(o),s=window.performance.now()-t;yield,t=window.performance.now();const c=l(o,new r.Vector3(0,1,0),50);B.sortEdges&&c.sort(((e,t)=>Math.min(e.start.y,e.end.y)-Math.min(t.start.y,t.end.y)));const u=window.performance.now()-t;yield,v.add(z);const w=[],L=new r.Line3,A=new r.Ray,$=new r.Vector3;t=window.performance.now();let E=0;for(let n=0,o=c.length;n<o;n++){const o=c[n];if(f(o))continue;const r=Math.min(o.start.y,o.end.y),i=[];a.shapecast({intersectsBounds:e=>!B.useBVH||(e.min.y=Math.min(r,e.min.y),A.origin.copy(o.start),o.delta(A.direction).normalize(),!!e.containsPoint(A.origin)||!!A.intersectBox(e,$)&&A.origin.distanceToSquared($)<o.distanceSq()),intersectsTriangle:e=>{if(Math.max(e.a.y,e.b.y,e.c.y)<r)return!1;if(y(e))return!1;if(m(e,o))return!1;if(h(e,o,L),p(e.plane,L))return!1;if(L.distance()<1e-10)return!1;if(g(e,o,i)&&b(i),0!==i.length){const[e,t]=i[i.length-1];return 0===e&&1===t}return!1}}),M(o,i,w);const s=window.performance.now()-t;s>e&&(C.innerText=`processing: ${(100*n/c.length).toFixed(2)}%`,E+=s,z.geometry.dispose(),z.geometry=x(w,0),yield,t=window.performance.now())}z.geometry.dispose(),z.geometry=x(w,0),E+=window.performance.now()-t,C.innerText=`merge geometry  : ${i.toFixed(2)}ms\nbvh generation  : ${s.toFixed(2)}ms\nedge generation : ${u.toFixed(2)}ms\nedge trimming   : ${E.toFixed(2)}ms\n\ntotal time      : ${(i+s+u+E).toFixed(2)}ms\ntotal edges     : ${w.length} edges`}function R(){if(requestAnimationFrame(R),G){G.next().done&&(G=null)}P.visible="color"===B.displayModel,q.visible="white"===B.displayModel,F.visible=B.displayEdges,z.visible=B.displayProjection,A.render(v,$)}!async function(){C=document.getElementById("output");A=new r.WebGLRenderer({antialias:!0}),A.setPixelRatio(window.devicePixelRatio),A.setSize(window.innerWidth,window.innerHeight),A.setClearColor(15658734,1),A.outputEncoding=r.sRGBEncoding,document.body.appendChild(A.domElement),v=new r.Scene;const e=new r.DirectionalLight(16777215,1);e.position.set(1,2,3),v.add(e),v.add(new r.AmbientLight(11583173,.25)),S=new r.Group,v.add(S),window.addEventListener("resize",(function(){$.aspect=window.innerWidth/window.innerHeight,$.updateProjectionMatrix(),A.setSize(window.innerWidth,window.innerHeight)}),!1);const t=await(new s.GLTFLoader).setMeshoptDecoder(L.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/nasa-m2020/Perseverance.glb");P=t.scene;const n=new r.MeshStandardMaterial;q=P.clone(),q.traverse((e=>{e.material&&(e.material=n)})),S.updateMatrixWorld(!0);const o=new r.Box3;o.setFromObject(P,!0),o.getCenter(S.position).multiplyScalar(-1),S.position.y=Math.max(0,-o.min.y)+1,S.add(P,q),F=new r.Group,P.traverse((e=>{if(e.geometry){const t=new r.LineSegments(new r.EdgesGeometry(e.geometry,50),new r.LineBasicMaterial({color:197379}));t.position.copy(e.position),t.quaternion.copy(e.quaternion),t.scale.copy(e.scale),F.add(t)}})),S.add(F),z=new r.LineSegments(new r.BufferGeometry,new r.LineBasicMaterial({color:197379})),v.add(z),$=new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,100),$.position.setScalar(3.5),$.updateProjectionMatrix(),T=new a.OrbitControls($,A.domElement),E=new i.GUI,E.add(B,"displayModel",["none","color","white"]),E.add(B,"displayEdges"),E.add(B,"displayProjection"),E.add(B,"useBVH"),E.add(B,"sortEdges"),E.add(B,"rotate"),E.add(B,"regenerate"),G=j(),R()}();
//# sourceMappingURL=edgeProjection.59721e0c.js.map
