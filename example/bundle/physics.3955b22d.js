function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},a={},i=t.parcelRequire4485;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in a){var t=a[e];delete a[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},t.parcelRequire4485=i);var o,r,d=i("ilwiq"),l=i("7lx9d"),s=i("5Rd1x"),c={};o=c,r=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";a=e}var a=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),n(++a%i.children.length)}),!1);var o=(performance||Date).now(),r=o,d=0,l=t(new e.Panel("FPS","#0ff","#002")),s=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){d++;var e=(performance||Date).now();if(s.update(e-o,200),e>r+1e3&&(l.update(1e3*d/(e-r),100),r=e,d=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var a=1/0,i=0,o=Math.round,r=o(window.devicePixelRatio||1),d=80*r,l=48*r,s=3*r,c=2*r,p=3*r,h=15*r,m=74*r,u=30*r,f=document.createElement("canvas");f.width=d,f.height=l,f.style.cssText="width:80px;height:48px";var w=f.getContext("2d");return w.font="bold "+9*r+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=n,w.fillRect(0,0,d,l),w.fillStyle=t,w.fillText(e,s,c),w.fillRect(p,h,m,u),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(p,h,m,u),{dom:f,update:function(l,y){a=Math.min(a,l),i=Math.max(i,l),w.fillStyle=n,w.globalAlpha=1,w.fillRect(0,0,d,h),w.fillStyle=t,w.fillText(o(l)+" "+e+" ("+o(a)+"-"+o(i)+")",s,c),w.drawImage(f,p+r,h,m-r,u,p,h,m-r,u),w.fillRect(p+m-r,h,r,u),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(p+m-r,h,r,o((1-l/y)*u))}}},e},"object"==typeof c?c=r():"function"==typeof define&&define.amd?define(r):o.Stats=r();var p=i("jiuw3"),h=i("4CEV9");const m={displayCollider:!1,displayBVH:!1,displayParents:!1,visualizeDepth:10,gravity:-9.8,physicsSteps:5,simulationSpeed:1,sphereSize:1,pause:!1,step:()=>{const e=m.physicsSteps;for(let t=0;t<e;t++)H(.016/e)},explode:function(){const e=new d.Vector3;V.forEach((t=>{e.copy(t.position),e.y+=10,e.normalize(),t.velocity.addScaledVector(e,120)}))},reset:function(){V.forEach((e=>{e.material.dispose(),e.geometry.dispose(),w.remove(e)})),V.length=0,b.forEach((e=>{e.material.dispose(),e.geometry.dispose(),w.remove(e)})),b.length=0}};let u,f,w,y,S,v,g,M,x;const V=[],b=[],P=new d.Sphere,C=new d.Vector3,E=new d.Vector3,z=new d.Vector3(0,0,1);function R(e,t,n,a,i,o=0){if(i<Math.max(Math.abs(.04*m.gravity),5))return;const r=2*Math.max(t?Math.max(e.collider.radius,t.collider.radius):e.collider.radius,.4),l=new d.Mesh(new d.RingBufferGeometry(0,1,30),new d.MeshBasicMaterial({side:2,transparent:!0,depthWrite:!1}));l.lifetime=0,l.maxLifetime=.4,l.maxScale=r*Math.max(Math.sin(Math.min(i/200,1)*Math.PI/2),.35),l.position.copy(n).addScaledVector(a,o),l.quaternion.setFromUnitVectors(z,a),w.add(l),b.push(l)}function L(){const e=new d.Color(16777215),t=new d.Color(1251612).lerp(e,.5*Math.random()+.5).convertSRGBToLinear(),n=new d.Mesh(new d.SphereGeometry(1,20,20),new d.MeshStandardMaterial({color:t}));w.add(n),n.castShadow=!0,n.receiveShadow=!0,n.material.shadowSide=2;const a=.5*m.sphereSize*(.2*Math.random()+.6);return n.scale.setScalar(a),n.collider=new d.Sphere(n.position,a),n.velocity=new d.Vector3(0,0,0),n.mass=Math.pow(a,3)*Math.PI*4/3,V.push(n),n}function B(e){const t=M.geometry.boundsTree;for(let n=0,a=V.length;n<a;n++){const i=V[n],o=i.collider;if(i.velocity.y+=m.gravity*e,o.center.addScaledVector(i.velocity,e),o.center.y<-80){V.splice(n,1),n--,a--,i.material.dispose(),i.geometry.dispose(),w.remove(i);continue}P.copy(i.collider);let r=!1;if(t.shapecast({intersectsBounds:e=>e.intersectsSphere(P),intersectsTriangle:e=>{e.closestPointToPoint(P.center,C),C.sub(P.center);const t=C.length();if(t<P.radius){const e=t-P.radius;C.multiplyScalar(1/t),P.center.addScaledVector(C,e),r=!0}},traverseBoundsOrder:e=>e.distanceToPoint(P.center)-P.radius}),r){C.subVectors(P.center,o.center).normalize(),i.velocity.reflect(C);const t=i.velocity.dot(C);i.velocity.addScaledVector(C,.5*-t),i.velocity.multiplyScalar(Math.max(1-e,0)),o.center.copy(P.center),E.copy(P.center).addScaledVector(C,-P.radius),R(i,null,E,C,t,.05)}}for(let e=0,t=V.length;e<t;e++){const n=V[e],a=n.collider;for(let i=e+1;i<t;i++){const e=V[i],t=e.collider;C.subVectors(a.center,t.center);const o=C.length()-(a.radius+t.radius);if(o<0){C.normalize();const i=n.velocity.dot(C),r=e.velocity.dot(C),l=Math.max(i,.2),s=Math.max(r,.2),c=l+s,p=l/c,h=s/c;a.center.addScaledVector(C,-p*o),t.center.addScaledVector(C,h*o);const m=new d.Vector3;m.addScaledVector(C,-i).addScaledVector(C,r);const u=m.length(),f=n.mass,w=e.mass;let y,S;const v=.5;m.dot(n.velocity)>m.dot(e.velocity)?(y=v*u*(f-w)/(f+w),S=v*u*2*f/(f+w),y-=u):(y=v*u*2*w/(f+w),S=v*u*(w-f)/(f+w),S-=u),m.normalize(),n.velocity.addScaledVector(m,y),e.velocity.addScaledVector(m,S),E.copy(a.center).addScaledVector(C,-a.radius),R(n,e,E,C,u,0)}}n.position.copy(a.center)}}function H(e){if(M){const t=m.physicsSteps;for(let n=0;n<t;n++)B(e/t)}for(let t=0,n=b.length;t<n;t++){const a=b[t];a.lifetime+=e;const i=a.lifetime/a.maxLifetime;let o=Math.sin(4.5*i*Math.PI/4);o=1-Math.pow(1-o,2),a.scale.setScalar(o*a.maxScale),a.material.opacity=1-Math.sin(2*i*Math.PI/4),i>=1&&(b.splice(t,1),a.parent.remove(a),a.geometry.dispose(),a.material.dispose(),t--,n--)}}!function(){const t=1251612;u=new d.WebGLRenderer({antialias:!0}),u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.setClearColor(t,1),u.shadowMap.enabled=!0,u.shadowMap.type=d.PCFSoftShadowMap,u.outputEncoding=d.sRGBEncoding,document.body.appendChild(u.domElement),w=new d.Scene,w.fog=new d.Fog(t,30,70);const n=new d.DirectionalLight(11193599,1);n.position.set(1,1.5,1).multiplyScalar(50),n.intensity=.25;const a=n.shadow.camera;a.bottom=a.left=-10,a.top=a.right=10,w.add(n),w.add(new d.HemisphereLight(4491519,2241348,.3)),f=new d.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),f.position.set(10,10,-10),f.far=100,f.updateProjectionMatrix(),window.camera=f,y=new d.Clock,new s.OrbitControls(f,u.domElement),v=new(e(c)),document.body.appendChild(v.dom),(new l.GLTFLoader).load("../models/low_poly_environment_jungle_scene/scene.gltf",(e=>{g=e.scene,g.scale.setScalar(.05);const t=new d.PointLight(65535);t.distance=7,t.position.set(-100,-40,100),g.add(t);const n=new d.PointLight(16768358);n.distance=15,n.intensity=5,n.position.set(80,80,135),n.shadow.normalBias=.01,n.shadow.bias=-.001,n.shadow.mapSize.setScalar(1024),n.castShadow=!0,g.add(n),g.updateMatrixWorld(!0);const a=new h.StaticGeometryGenerator(g);a.attributes=["position"];const i=a.generate();i.boundsTree=new h.MeshBVH(i),M=new d.Mesh(i),M.material.wireframe=!0,M.material.opacity=.5,M.material.transparent=!0,x=new h.MeshBVHVisualizer(M,m.visualizeDepth),w.add(x),w.add(M),w.add(g),g.traverse((e=>{e.material&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2)}))})),S=new p.GUI;const i=S.addFolder("Visualization");i.add(m,"displayCollider"),i.add(m,"displayBVH"),i.add(m,"displayParents").onChange((e=>{x.displayParents=e,x.update()})),i.add(m,"visualizeDepth",1,20,1).onChange((e=>{x.depth=e,x.update()})),i.open();const o=S.addFolder("Physics");o.add(m,"physicsSteps",0,30,1),o.add(m,"gravity",-100,100,.01).onChange((e=>{m.gravity=parseFloat(e)})),o.add(m,"simulationSpeed",0,5,.01),o.add(m,"sphereSize",.2,5,.1),o.add(m,"pause"),o.add(m,"step"),o.open(),S.add(m,"explode"),S.add(m,"reset"),S.open();const r=new d.Raycaster,V=new d.Vector2;let b=0,P=0;u.domElement.addEventListener("pointerdown",(e=>{b=e.clientX,P=e.clientY})),u.domElement.addEventListener("pointerup",(e=>{if(Math.abs(e.clientX-b)+Math.abs(e.clientY-P)>2)return;V.x=e.clientX/window.innerWidth*2-1,V.y=-e.clientY/window.innerHeight*2+1,r.setFromCamera(V,f);const t=L();t.position.copy(f.position).addScaledVector(r.ray.direction,3),t.velocity.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).addScaledVector(r.ray.direction,10*Math.random()+15).multiplyScalar(.5)})),window.addEventListener("resize",(function(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight)}),!1),window.createSphere=L}(),function e(){v.update(),requestAnimationFrame(e);const t=Math.min(y.getDelta(),.1);M&&(M.visible=m.displayCollider,x.visible=m.displayBVH,m.pause||H(m.simulationSpeed*t));u.render(w,f)}();
//# sourceMappingURL=physics.3955b22d.js.map
